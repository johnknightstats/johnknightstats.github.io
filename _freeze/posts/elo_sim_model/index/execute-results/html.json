{
  "hash": "bc7df2bc408d00787ca322210a408215",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Building a model to simulate football scores from Elo ratings\"\nimage: viz/cond_plots.png\nauthor: \"John Knight\"\ndate: 2025-07-12\ndate-format: \"D MMMM YYYY\"\ndescription: \"I demonstrate how the Poisson and negative binomial distributions compare to actual football scores from the English top flight, and how we can convert Elo ratings into correct score probabilities.\"\ncategories: [\"football\", \"statistics\"]\nformat:\n  html:\n    title-block-style: \"default\"  \n    title-block-categories: true\n    css: ../../styles.css\nexecute: \n  echo: false\n  eval: true\nengine: knitr\neditor: source\n\n---\n\n*I demonstrate how the Poisson and negative binomial distributions compare to actual football scores from the English top flight, and how we can convert Elo ratings into correct score probabilities.*\n\n---\n### Background\n\nI hope you enjoyed my recent article looking at the worst league title collapses in English football history. If not, you can read it [here](https://johnknightstats.com/posts/title_collapses/).\n\nNow I will go into a little more depth on the model I used to simulate scores using daily Elo ratings from [Club Elo](http://clubelo.com/). You can find all my code and data files for this project in my [GitHub repo](https://github.com/johnknightstats/elo-league-sims).\n\nSince the Elo ratings only begin in 1940, we will have to ignore results prior to World War Two. Our first task, as always, is to do some data inspection.\n\n### How Football Has Changed Since 1946\n\nFirst, let's look at the changes in goalscoring rate through the years. Now, I decided not to account for varying goal rates in this model, because it adds a fair amount of complexity and I didn't think it would be necessary given the task at hand. Nonetheless, it is still interesting to see how the game has changed over the last 80 years, especially the huge decrease in the latter half of the 1960s:\n\n::: {.centered-block .max-70}\n<img src=\"viz/goals_pg_seasons.png\"/>\n:::\n\nWe can also take a look at how **home supremacy** has changed in the English top flight. This has shown a steady downward trend, presumably due to improved travel and accommodation for away sides. Not many teams took their own chef on the road in the 1950s.\n\nAnd to help answer the question \"how much of home advantage is due to the fans?\" we can look at the 2021 COVID season, played in empty stadia, where home supremacy dropped to almost **zero**. \n\n::: {.centered-block .max-70}\n<img src=\"viz/home_suprem_seasons.png\"/>\n:::\n\nFinally, we can summarise the mean Elo rating of English top flight teams over the same time period. The overall trend is upward, and it is also notable that the standard deviation (shown by the light blue band) gets wider as time goes on. The spread of team quality in the modern Premier League, as I'm sure you are aware, is much wider than it used to be.\n\n::: {.centered-block .max-70}\n<img src=\"viz/elo_mean_seasons.png\"/>\n:::\n\n### How Do Elo Ratings Work?\n\nNow we can look at the Elo rating system itself. It was originally designed by Arpad Elo to rank chess players, but can be extended to any zero-sum game with two players or teams. \n\nWhen two teams play against one another, they are effectively gambling a portion of their points, with the better team (according to their Elo ratings) putting more of their points at stake than the inferior team. \n\nSince the winner gains the same number of points as the loser loses (the definition of 'zero-sum'), the population of ratings sits around a consistent long-term average - typically 1500, but any arbitrary number can be chosen.\n\nYou can find a full explanation of how Club Elo calculates its ratings [here](http://clubelo.com/System). There are adjustments for margin of victory, home advantage, and what they call \"tilt\" (whether a team's games are higher or lower scoring than average).\n\nWe can use Club Elo's formula to calculate the predicted probability for each game in the data, with 0.5 awarded for a draw. Below I have plotted the deciles of teams' predicted probability to see how they match up with actual results. \n\n::: {.centered-block .max-70}\n<img src=\"viz/elo_deciles.png\"/>\n:::\n\nThe plotted points should approximately follow the dashed line but as you can see, Elo seems to overestimate favourites' chances and underestimate underdogs' chances. \n\nTo reiterate, this is when allotting 0.5 points for a draw. I don't know how it would fare when trying to predict actual win-draw-lose results instead, or if it's possible to derive that simply from the Elo difference. \n\nBut that is our next task!\n\n### Generating Realistic Football Scores\n\nClearly if we are going to simulate league tables, we need actual scores rather than just results. And we certainly need some draws and not \"half wins\". So how can we simulate realistic football scores?\n\nNow let me make it clear at this point, I am not breaking any new ground here. There is a large body of work dedicated to the distribution of football scores going back as far as the 1950s. For further reading I recommend [Reep](https://academic.oup.com/jrsssa/article/134/4/623/7104572), [Maher](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1467-9574.1982.tb00782.x), [Dixon-Coles](https://rss.onlinelibrary.wiley.com/doi/abs/10.1111/1467-9876.00065), and others. \n\nBut I find it useful and educational to try and build these things yourself step by step, so here we go. I promise to try and keep the maths (math for American readers) as light as possible.\n\n### Useful Probability Distributions\n\nIn statistics, when we have an event that will happen some random number of times during a time interval, it is common to use the **Poisson** distribution. Given that we know the average number of goals scored by teams in our dataset (1.42), we can simply plug that into R's `dpois` function and it will give us the probability of 0 goals, 1 goal, 2 goals, and so forth. \n\nThen we can compare these probabilities with the actual observed relative frequency of each score:\n\n::: {.centered-block .max-70}\n<img src=\"viz/poisson_v_obs.png\"/>\n:::\n\nSo what's going on? Poisson is overpredicting scores of 1, 2 and 3, but underpredicting 0, 4, 5, and all higher scores up to infinity. This is a problem known as **overdispersion**. \n\nThe Poisson distribution relies on an assumption that the **mean** is equal to the **variance**. In reality, this assumption is often not satisfied. \n\nIndeed, the variance of our football scores is **1.65** compared to the mean of **1.42**. That's why the actual scores are more spread out (more 0s, more 5s and 6s) compared to the Poisson predictions (more 1s and 2s).\n\nThis is where the **negative binomial** distribution comes to our rescue! The negative binomial distribution in its most common form would be used to model things like \"if I have a 70% chance of making each free throw, what is the probability that I miss exactly 5 free throws before I make my 10th successful free throw?\" Anyone who took a probability class at university will be familiar with fun questions like that.\n\nBut the negative binomial distribution can also be expressed in a different way to make it very similar to the Poisson distribution, with a mean but also an additional parameter &theta; which is known (amongst other things) as the **dispersion** parameter. This allows us to build a Poisson-like distribution but to toggle the shape by changing &theta;. The two distributions are related - in fact, if you keep increasing &theta;, the negative binomial gets closer and closer to Poisson.\n\nBelow I have added the negative binomial distribution (with &theta; = 10) alongside the Poisson and the actual observed results:\n\n::: {.centered-block .max-70}\n<img src=\"viz/poisson_v_nb_v_obs.png\"/>\n:::\n\nNot bad! We instantly see that this is a huge improvement over Poisson, and honestly does a pretty good job of fitting the actual observed scores. To demonstrate how increasing &theta; affects the negative binomial distribution, here is the same plot with &theta; = 10,000. It is now indistinguishable from the Poisson distribution:\n\n::: {.centered-block .max-70}\n<img src=\"viz/poisson_v_nb_v_obs_10k.png\"/>\n:::\n\nSo we're done, right? Just use a negative binomial distribution with &theta; = 10 to model football scores. Not so simple, I'm afraid! That would be making an assumption that you can generate a score for team A, and then generate a score for team B, as if the two things happen independently. But is that a fair assumption?\n\n### Are Team Scores Independent?\n\nTo test that assumption we need to look at the *conditional* distribution of a team once we know how many goals their opponents have scored:\n\n::: {.centered-block .max-70}\n<img src=\"viz/cond_plots.png\"/>\n:::\n\nSo now we can see there is a problem. When the opponent has scored 0, the distribution underestimates 0. When the opponent has scored 1, the distribution underestimates 1. When the opponent has scored 2, the distribution underestimates 2, and so on.\n\nWhat this means is, in actual football, there are more draws than would be expected by generating two independent scores. This is not hard to explain: when a game is level, teams will take relatively fewer risks. When a team is trailing by one goal, they will throw men forward and make the game more open in pursuit of an equaliser. So the overall effect is that final scores are slightly more likely to be draws.\n\n### Accounting for Team Strength\n\nWe also have another problem that we haven't addressed yet. We are generating scores for an aggregate of all teams in our dataset. But teams' abilities can vary significantly! So we need an algorithm that gives us the mean and distribution for one team, based on the difference in the teams' Elo ratings, and then the mean and distribution for the second team, based not only on the Elo ratings but also on the score of the first team!\n\nThe simplest way to approach this is by first generating the score of the favourite (i.e. the team with the higher Elo rating after home advantage has been applied). I fit this with a simple quadratic model of the difference in Elo ratings. Below we can see how this compares with the negative binomial with &theta; = 35. Remember, this is now an aggregation of different predictions across all of the games in the dataset.\n\n::: {.centered-block .max-70}\n<img src=\"viz/fav_goals_fitted.png\"/>\n:::\n\nIt's a good fit. So the favourites at least seem to be sorted, and we can see that the negative binomial with &theta; = 35 is superior to Poisson. \n\nBut what about the underdog? It's slightly more complex to fit the underdog's mean goals scored because now we have to account for the number of goals scored by the favourite. \n\nIn addition, I added **interaction** terms to the quadratic model. What are interactions? A simple way to explain this is, if Real Madrid were playing against Tranmere Rovers and I told you Real Madrid scored 3 goals, would it change your prediction of how many Tranmere scored? Probably not. If I told you Tranmere scored 3? Clearly your estimates for Real Madrid scoring 3+ should increase. That is an interaction between two variables, because the first variable (number of goals scored by the opposition) has a different effect on the outcome depending on a second variable (quality of the opposition).\n\nSo let's see how the underdog scores come out, conditional on the goals scored by the favourite:\n\n::: {.centered-block .max-70}\n<img src=\"viz/underdog_cond_plots_dispersion_5.png\"/>\n:::\n\nClearly there is a problem. I tried a few different values of &theta; - the above plots are with &theta; = 5 because that's a good fit when the favourite scores 0. But it's a poor fit for the other scores. So what we probably need is a different &theta; depending on the favourite's score!\n\nI trained a function to find the optimal &theta; for each value of the favourite's score, and these were the results:\n\n::: {.centered-block .max-70}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"zlvwumzytl\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:500px;height:auto;\">\n<style>#zlvwumzytl table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#zlvwumzytl thead, #zlvwumzytl tbody, #zlvwumzytl tfoot, #zlvwumzytl tr, #zlvwumzytl td, #zlvwumzytl th {\n  border-style: none;\n}\n\n#zlvwumzytl p {\n  margin: 0;\n  padding: 0;\n}\n\n#zlvwumzytl .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#zlvwumzytl .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zlvwumzytl .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zlvwumzytl .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zlvwumzytl .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zlvwumzytl .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zlvwumzytl .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zlvwumzytl .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zlvwumzytl .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#zlvwumzytl .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#zlvwumzytl .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zlvwumzytl .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zlvwumzytl .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zlvwumzytl .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zlvwumzytl .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlvwumzytl .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zlvwumzytl .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zlvwumzytl .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#zlvwumzytl .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlvwumzytl .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zlvwumzytl .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlvwumzytl .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zlvwumzytl .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlvwumzytl .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zlvwumzytl .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zlvwumzytl .gt_left {\n  text-align: left;\n}\n\n#zlvwumzytl .gt_center {\n  text-align: center;\n}\n\n#zlvwumzytl .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zlvwumzytl .gt_font_normal {\n  font-weight: normal;\n}\n\n#zlvwumzytl .gt_font_bold {\n  font-weight: bold;\n}\n\n#zlvwumzytl .gt_font_italic {\n  font-style: italic;\n}\n\n#zlvwumzytl .gt_super {\n  font-size: 65%;\n}\n\n#zlvwumzytl .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#zlvwumzytl .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zlvwumzytl .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#zlvwumzytl .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#zlvwumzytl .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#zlvwumzytl .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#zlvwumzytl .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#zlvwumzytl .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#zlvwumzytl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Fav_Goals\">Fav_Goals</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Dispersion\">Dispersion</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Fav_Goals\" class=\"gt_row gt_center\">0</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">8</td></tr>\n    <tr><td headers=\"Fav_Goals\" class=\"gt_row gt_center\">1</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">35</td></tr>\n    <tr><td headers=\"Fav_Goals\" class=\"gt_row gt_center\">2</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">61</td></tr>\n    <tr><td headers=\"Fav_Goals\" class=\"gt_row gt_center\">3</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">10000</td></tr>\n  </tbody>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n:::\n\n<br>\n\nLet's see how the conditional plots look with these fitted dispersions:\n\n::: {.centered-block .max-70}\n<img src=\"viz/underdog_cond_plots_fitted_dispersion.png\"/>\n:::\n\nAs Roy Walker would say: \"It's good, but it's not the one.\" So now it's time to use some brute force. We know that the underdog's score is more likely to match the favourite's score, so let's do exactly that. \n\n### Inflating Draw Probabilities\n\nI repeated the last optimization, but this time with an extra parameter that inflates the probability of the underdog getting the same score as the favourite. All values were adjusted proportionally to ensure the total probability was still 1, of course. Here are the results:\n\n::: {.centered-block .max-70}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"swarsztivn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:500px;height:auto;\">\n<style>#swarsztivn table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#swarsztivn thead, #swarsztivn tbody, #swarsztivn tfoot, #swarsztivn tr, #swarsztivn td, #swarsztivn th {\n  border-style: none;\n}\n\n#swarsztivn p {\n  margin: 0;\n  padding: 0;\n}\n\n#swarsztivn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#swarsztivn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#swarsztivn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#swarsztivn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#swarsztivn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#swarsztivn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swarsztivn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#swarsztivn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#swarsztivn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#swarsztivn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#swarsztivn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#swarsztivn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#swarsztivn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#swarsztivn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#swarsztivn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#swarsztivn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#swarsztivn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#swarsztivn .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#swarsztivn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swarsztivn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#swarsztivn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#swarsztivn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#swarsztivn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swarsztivn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#swarsztivn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#swarsztivn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swarsztivn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swarsztivn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#swarsztivn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swarsztivn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#swarsztivn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swarsztivn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#swarsztivn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swarsztivn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#swarsztivn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swarsztivn .gt_left {\n  text-align: left;\n}\n\n#swarsztivn .gt_center {\n  text-align: center;\n}\n\n#swarsztivn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#swarsztivn .gt_font_normal {\n  font-weight: normal;\n}\n\n#swarsztivn .gt_font_bold {\n  font-weight: bold;\n}\n\n#swarsztivn .gt_font_italic {\n  font-style: italic;\n}\n\n#swarsztivn .gt_super {\n  font-size: 65%;\n}\n\n#swarsztivn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#swarsztivn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#swarsztivn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#swarsztivn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#swarsztivn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#swarsztivn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#swarsztivn .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#swarsztivn .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#swarsztivn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Opp_Goals\">Opp_Goals</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Dispersion\">Dispersion</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Inflation\">Inflation</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Opp_Goals\" class=\"gt_row gt_center\">0</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">569</td>\n<td headers=\"Inflation\" class=\"gt_row gt_center\">0.093</td></tr>\n    <tr><td headers=\"Opp_Goals\" class=\"gt_row gt_center\">1</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">14</td>\n<td headers=\"Inflation\" class=\"gt_row gt_center\">0.050</td></tr>\n    <tr><td headers=\"Opp_Goals\" class=\"gt_row gt_center\">2</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">321</td>\n<td headers=\"Inflation\" class=\"gt_row gt_center\">0.009</td></tr>\n    <tr><td headers=\"Opp_Goals\" class=\"gt_row gt_center\">3</td>\n<td headers=\"Dispersion\" class=\"gt_row gt_center\">198</td>\n<td headers=\"Inflation\" class=\"gt_row gt_center\">0.006</td></tr>\n  </tbody>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n:::\n\n<br>\n\nSo when the favourite scores 0, there is a big boost to the probability of the underdog scoring 0. When the favourite scores 1, the effect reduces by almost half. For 2 or more goals, the inflation is minimal.\n\nNow how does that look in the conditional distribution?\n\n::: {.centered-block .max-70}\n<img src=\"viz/underdog_cond_pointmass.png\"/>\n:::\n\nI'm pretty happy with that overall. The scores seem to track reality quite well, so we can now generate a probability of every scoreline (0-0, 2-1, 3-3, etc) for each game in the dataset and derive probabilities of win-draw-loss for each team. Let's calibrate our model by comparing these probabilities with the actual results and scores:\n\n::: {.centered-block .max-70}\n<img src=\"viz/deciles_new.png\"/>\n:::\n\n::: {.centered-block .max-70}\n<img src=\"viz/wdl.png\"/>\n:::\n\n::: {.centered-block .max-70}\n<img src=\"viz/model_v_scores.png\"/>\n:::\n\nThe deciles track pretty nicely as the dashed line falls inside all the error bars except one. Note that the probabilities are different to the earlier decile plot because that one was using \"half wins\" when a game was drawn, whereas this plot assumes a draw is not a win (i.e. it is 0, the same as a loss).\n\nThe W-D-L plot and correct scores plot are close; there just seems to be a stubborn difference in the 1-1 predictions for some reason. But for the task at hand, this should easily be adequate.\n\n### Summary\n\nVia this process we have ended up with something similar to the Dixon-Coles model, which uses a Poisson distribution with inflated probabilities of low scores (0-0, 0-1, 1-1, 1-0).\n\nBy fitting scores conditionally and inflating the probability of draws, we have a system that can generate realistic match outcomes from Elo ratings alone. This forms a solid foundation for simulating league tables and other competitions, although for advanced analysis I would always advise users to be conscious of the [GIGO](https://en.wikipedia.org/wiki/Garbage_in,_garbage_out) problem.\n\nThanks for reading, and as I mentioned earlier, you can find all the code relating to this project at my [GitHub repo](https://github.com/johnknightstats/elo-league-sims).\n\n::: {.data-footer}\n\n**Data Sources**  \nI gather match data from a variety of public sources. Please check out these excellent websites:\n\n- [Club Elo Ratings](https://clubelo.com)\n- [ESPN](https://www.espn.com/soccer/)\n- [FBref](https://fbref.com)\n- [FotMob](https://fotmob.com)\n- [Transfermarkt](https://transfermarkt.com)\n- [Understat](https://understat.com)\n- [WhoScored](https://whoscored.com)\n- [World Football Elo Ratings](http://eloratings.net/)\n\nI welcome feedback! Feel free to contact me at [knightjohn2@gmail.com](mailto:knightjohn2@gmail.com).\n:::\n\n\nÂ© 2025 John Knight. All rights reserved.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}